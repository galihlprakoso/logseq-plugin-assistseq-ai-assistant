import "@logseq/libs";

import React from "react";
import * as ReactDOM from "react-dom/client";
import {
  QueryClient,
  QueryClientProvider,
} from 'react-query'
import settings from './settings'
import App from "./App";
import GeminiContextProvider from './modules/gemini/components/GeminiContextProvider'
import "./index.css";

import { logseq as PL } from "../package.json";
import OpenAIContextProvider from "./modules/openai/components/OpenAIContextProvider";

// @ts-expect-error
const css = (t, ...args) => String.raw(t, ...args);

const pluginId = PL.id;

const queryClient = new QueryClient()

function main() {
  const root = ReactDOM.createRoot(document.getElementById("app")!);

  root.render(
    <React.StrictMode>
      <QueryClientProvider client={queryClient}>
        <GeminiContextProvider>
          <OpenAIContextProvider>
            <App />
          </OpenAIContextProvider>
        </GeminiContextProvider>
      </QueryClientProvider>
    </React.StrictMode>
  );

  function createModel() {
    return {
      show() {
        logseq.showMainUI();
      },
    };
  }

  logseq.provideModel(createModel());
  logseq.setMainUIInlineStyle({
    zIndex: 11,
  });

  const openIconName = "template-plugin-open";

  logseq.provideStyle(css`
    .${openIconName} {
      opacity: 0.55;
      font-size: 20px;
      margin-top: 4px;
    }

    .${openIconName}:hover {
      opacity: 0.9;
    }
  `);

  logseq.App.registerUIItem("toolbar", {
    key: openIconName,
    template: `
      <a id="${pluginId}" data-on-click="show" data-rect class="button">          
          <svg class="w-5 h-5" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 678 647" version="1.1"><path d="" stroke="none" fill="currentColor" fill-rule="evenodd"/><path d="M 294.380 49.460 C 249.015 55.602, 214.528 68.138, 178.368 91.632 C 129.383 123.457, 87.807 178.050, 71.940 231.380 C 68.409 243.247, 68.310 246.210, 71.250 252.030 C 75.640 260.720, 85.505 263.655, 94.096 258.826 C 99.472 255.805, 101.969 251.505, 107.047 236.532 C 118.508 202.737, 137.372 173.404, 164.626 146.995 C 199.751 112.960, 239.148 93.252, 288.970 84.794 C 305.580 81.975, 337.846 81.744, 355 84.323 C 397.263 90.676, 436.166 107.366, 468.500 133.016 C 476.416 139.295, 491.917 154.275, 490.984 154.742 C 490.718 154.875, 493.313 157.905, 496.750 161.476 C 500.188 165.046, 503 168.387, 503 168.900 C 503 169.413, 503.337 169.983, 503.750 170.167 C 504.582 170.537, 510.903 179.045, 515.512 186 C 517.152 188.475, 518.742 190.725, 519.045 191 C 520.027 191.891, 524.648 200.265, 529.832 210.547 C 544.375 239.395, 554.393 276.141, 553.673 298 C 553.360 307.476, 552.152 310.595, 548.189 312.154 C 546.555 312.797, 530.388 313.422, 506.988 313.748 C 469.611 314.267, 468.357 314.223, 464.488 312.239 C 459.784 309.828, 456.628 306.644, 454.835 302.500 C 453.914 300.373, 453.386 291.041, 453.018 270.419 L 452.500 241.338 449.692 237.660 C 446.216 233.107, 440.728 230.211, 435.486 230.165 C 430.929 230.125, 425 231.936, 425 233.368 C 425 233.899, 424.748 234.081, 424.439 233.773 C 423.650 232.984, 419.034 237.780, 418.023 240.439 C 417.561 241.656, 417.029 290.767, 416.841 349.576 C 416.472 465.184, 416.288 460.543, 421.932 477.954 C 426.336 491.538, 433.497 503.933, 442.838 514.140 C 445.677 517.242, 448 520.041, 448 520.359 C 448 522.350, 419.025 537.917, 405.899 542.979 C 396.280 546.688, 393.446 546.774, 390.365 543.448 L 388 540.897 387.981 485.698 C 387.950 394.203, 387.004 234.867, 386.457 229.087 C 385.713 221.232, 381.293 209.312, 376.939 203.418 C 368.225 191.622, 351.932 180.683, 339.201 178.083 C 331.409 176.491, 315.762 176.749, 308.644 178.586 C 288.840 183.699, 273.116 198.213, 265.123 218.758 L 262.500 225.500 262 383.500 C 261.596 511.259, 261.249 541.940, 260.189 543.798 C 257.129 549.162, 250.145 548.702, 235.500 542.173 C 220.422 535.450, 197 522.152, 197 520.313 C 197 520.034, 199.752 516.813, 203.117 513.153 C 211.030 504.545, 216.333 496.702, 221.055 486.619 C 227.319 473.246, 229.030 465.586, 230.016 446.500 C 231.051 426.491, 231.289 287.931, 230.336 260.659 C 229.748 243.845, 229.452 241.477, 227.581 238.659 C 225.113 234.941, 217.848 230.991, 213.538 231.022 C 208.391 231.059, 202.377 234.474, 199.316 239.096 L 196.500 243.350 196 273.002 L 195.500 302.655 192.816 306.706 C 191.202 309.143, 188.386 311.603, 185.750 312.879 C 181.508 314.933, 180.091 315, 141.135 315 L 100.902 315 94.968 310.815 C 89.947 307.274, 88.103 306.563, 82.982 306.192 C 74.866 305.605, 69.191 307.840, 64.093 313.631 C 55.052 323.903, 54.575 337.633, 62.880 348.582 C 68.232 355.638, 73.760 358.237, 82.500 357.806 C 88.873 357.491, 90.040 357.078, 95.532 353.187 L 101.563 348.914 142.619 349.207 L 183.674 349.500 187.802 352.362 C 194.610 357.082, 196.001 361.275, 195.994 377.066 C 195.991 384.455, 195.545 392.099, 195.002 394.052 C 193.914 397.969, 188.947 403.594, 185.023 405.353 C 183.351 406.103, 169.171 406.656, 143 406.992 C 98.438 407.565, 99.826 407.332, 91.518 415.639 C 85.676 421.482, 83.563 427.209, 84.280 435.256 C 84.736 440.383, 86.098 444.005, 91.889 455.500 C 120.946 513.178, 172.727 557.385, 237.186 579.543 C 267.844 590.082, 292.358 594.230, 324 594.234 C 360.477 594.238, 391.117 588.208, 426.500 574.060 C 444.784 566.749, 472.777 550.118, 490 536.332 C 530.829 503.652, 563.061 456.536, 579.845 405 C 592.232 366.962, 595.865 318.059, 589.390 276.500 C 583.412 238.127, 568.949 201.114, 547.189 168.500 C 525.275 135.656, 501.228 111.472, 470.677 91.552 C 438.159 70.349, 407.210 58.354, 367 51.369 C 348.805 48.208, 310.974 47.214, 294.380 49.460 M 318.344 212.041 C 309.471 213.797, 302.423 219.288, 297.858 228 L 295.500 232.500 295.192 386.500 C 294.970 497.103, 295.198 541.961, 295.999 545.685 C 296.859 549.681, 298.005 551.675, 300.998 554.379 C 305.912 558.819, 308.248 559.222, 326.737 558.825 C 343.201 558.471, 344.666 558.006, 349.438 551.615 C 351.494 548.862, 351.501 548.438, 352 395.677 C 352.385 277.838, 352.219 240.921, 351.282 235.655 C 349.084 223.304, 343.027 216.880, 329.893 212.968 C 326.258 211.886, 323.108 211.049, 322.892 211.110 C 322.676 211.170, 320.630 211.589, 318.344 212.041 M 516.500 351.086 C 511 351.409, 498.302 351.500, 488.282 351.289 C 476.893 351.049, 468.527 351.319, 465.963 352.010 C 461.336 353.256, 456.050 357.789, 456.777 359.888 C 457.042 360.651, 456.525 361.686, 455.629 362.188 C 454.249 362.960, 454 365.162, 454 376.582 C 454 393.918, 456.058 399.255, 464.500 403.808 C 468.270 405.841, 498.193 406.602, 520.090 405.222 C 536.130 404.211, 538.901 403.277, 542.815 397.565 C 545.352 393.863, 548.741 384.760, 549.419 379.830 C 549.670 377.999, 550.359 374.250, 550.949 371.500 C 553.134 361.314, 553.233 359.976, 552.011 357.025 C 551.325 355.371, 549.313 353.120, 547.538 352.024 C 544.091 349.893, 539.315 349.749, 516.500 351.086 M 128.655 442.829 C 125.016 446.850, 126.418 449.631, 142.351 470 C 149.797 479.520, 157.657 488.134, 160.771 490.187 C 166.134 493.724, 174.254 491.442, 181.342 484.407 C 193.999 471.843, 198.312 456.342, 191.599 447.541 C 186.711 441.133, 186.002 441, 156.705 441 C 132.404 441, 130.179 441.145, 128.655 442.829 M 472 442.698 C 464.448 443.728, 462.652 444.366, 459.491 447.142 C 454.499 451.525, 453.262 456.439, 455.453 463.181 C 456.403 466.106, 457.807 469.202, 458.573 470.059 C 459.338 470.917, 461.017 473.617, 462.304 476.059 C 465.124 481.412, 475.077 489.736, 479.692 490.602 C 481.907 491.018, 483.797 490.708, 485.382 489.669 C 490.114 486.569, 504.284 470.187, 509.195 462.138 C 510.416 460.137, 513.122 456.322, 515.208 453.660 C 517.293 450.998, 519 448.016, 519 447.033 C 519 443.209, 516.758 442.787, 495.265 442.569 C 483.844 442.452, 473.375 442.511, 472 442.698" stroke="none" fill="currentColor" fill-rule="evenodd"/></svg>
      </a>
    `,
  });
}

logseq.useSettingsSchema(settings).ready(main).catch(console.error);
